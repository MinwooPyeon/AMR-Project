# 모터-서보 동시 구동 테스트

이 테스트는 모터 드라이버와 서보 모터 드라이버를 동시에 동작시키는 기능을 검증합니다.

## 📋 개요

- **모터 드라이버**: PCA9685 기반 PWM 제어 (사용자 제공 코드 기반)
- **서보 드라이버**: Adafruit CircuitPython 라이브러리 사용 (사용자 제공 코드 기반)
- **동시 구동**: 멀티스레딩을 통한 병렬 제어

## 🚀 실행 방법

### 1. 자동 실행 (권장)
```bash
cd tests
python run_motor_servo_test.py
```

### 2. 수동 실행
```bash
cd tests
pip install -r requirements_motor_servo.txt
python motor_servo_simultaneous_test.py
```

## 📦 필요한 패키지

- `smbus2`: I2C 통신용
- `adafruit-circuitpython-pca9685`: PCA9685 PWM 컨트롤러
- `adafruit-circuitpython-motor`: 모터 제어
- `adafruit-blinka`: CircuitPython 호환성

## 🔧 하드웨어 설정

### 모터 드라이버 연결
- I2C 주소: `0x40`
- I2C 버스: `0번`
- PWM 주파수: `50Hz`

### 서보 드라이버 연결
- I2C 주소: `0x60`
- 서보 채널: `7번`
- PWM 주파수: `50Hz`

## 📊 테스트 시퀀스

### 1단계: 개별 테스트
1. **모터 드라이버 테스트**
   - 듀티 사이클 50% 설정
   - 레벨 HIGH/LOW 제어
   - 정지 상태 확인

2. **서보 드라이버 테스트**
   - 0도 → 180도 회전 (30도씩)
   - 180도 → 0도 회전 (30도씩)
   - 90도 중립 위치로 초기화

### 2단계: 동시 구동 테스트
- **모터 태스크**: 3회 사이클 (30% 듀티 사이클)
- **서보 태스크**: 3회 사이클 (0°↔180° 회전)
- **병렬 실행**: 멀티스레딩으로 동시 제어

## ⚠️ 주의사항

1. **하드웨어 연결 확인**
   - I2C 버스 연결 상태 확인
   - 전원 공급 상태 확인
   - 모터/서보 연결 상태 확인

2. **권한 설정**
   ```bash
   sudo usermod -a -G i2c $USER
   sudo chmod 666 /dev/i2c-0
   ```

3. **I2C 디바이스 확인**
   ```bash
   i2cdetect -y 0
   ```

## 🔍 문제 해결

### 일반적인 오류

1. **I2C 연결 오류**
   ```
   OSError: [Errno 121] Remote I/O error
   ```
   - I2C 버스 번호 확인
   - 하드웨어 연결 상태 확인
   - 권한 설정 확인

2. **패키지 설치 오류**
   ```bash
   pip install --upgrade pip
   pip install -r requirements_motor_servo.txt
   ```

3. **서보 각도 설정 오류**
   - 서보 모터 연결 상태 확인
   - 전원 공급 확인
   - 각도 범위 확인 (0°~180°)

## 📁 파일 구조

```
tests/
├── motor_servo_simultaneous_test.py  # 메인 테스트 파일
├── run_motor_servo_test.py           # 실행 스크립트
├── requirements_motor_servo.txt       # 패키지 목록
└── README_motor_servo_test.md        # 이 파일
```

## 🎯 테스트 결과

성공적인 테스트 실행 시 다음과 같은 출력을 확인할 수 있습니다:

```
============================================================
🚀 모터-서보 동시 구동 테스트 시작
============================================================

📋 1단계: 개별 테스트
----------------------------------------

🔧 모터 드라이버 테스트
모터 드라이버 초기화 - I2C 버스: 0, 주소: 0x40
모터 드라이버 초기화 성공
모터 PWM 주파수를 50 Hz로 설정
✅ 모터 테스트 완료

⚙️ 서보모터 드라이버 테스트
서보 드라이버 초기화 중...
서보 드라이버 초기화 성공
✅ 서보모터 테스트 완료

📋 2단계: 동시 구동 테스트
----------------------------------------
🔄 모터와 서보 동시 실행 시작
✅ 동시 구동 테스트 완료

🎉 모든 테스트 완료!
```

## 📞 지원

문제가 발생하면 다음을 확인해주세요:
1. 하드웨어 연결 상태
2. I2C 디바이스 인식 상태
3. 권한 설정 상태
4. 패키지 설치 상태 